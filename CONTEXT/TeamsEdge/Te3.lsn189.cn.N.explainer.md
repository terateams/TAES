# TE3：🔔 [N] Notify 深层洞见与 V1 设计

> **站点**: Te3.lsn189.cn | **更新**: 2026-01-23
>
> 本文档面向**产品经理**与**前端工程师**，提供 Notify 区域的深层理解与实施规格。
>
> - 菜单清单（路由/地址）：见 [Te3.lsn189.cn.md](Te3.lsn189.cn.md) 的 ⚪ [—] 系统治理分区
> - 其他概念说明：见 [Te3.lsn189.cn.explainer.md](Te3.lsn189.cn.explainer.md)

---

## 文档结构

| 章节 | 内容 | 读者 |
|------|------|------|
| §1 核心约束 | 信噪比优先原则 | PM / 架构师 |
| §2 设计原则 | 五大原则 | PM / 前端 |
| §3 深层洞见 | N 的本质理解 | PM / 架构师 |
| §4 V1 规格 | 前端实施细节 | 前端工程师 |

---

## §1 核心约束：信噪比决定 N 的成败

```
N 的价值 = 信号强度 / 噪音强度

信噪比高 → N 是"及时雨"
信噪比低 → N 是"垃圾场" → 认知疲劳 → 用户关闭通知 → N 归零
```

> **核心洞见**：N 的前提不是"能发"，而是"发得准"。否则实施代价 > 收益。

---

## §2 五大设计原则

### 原则一：默认静默（Silence by Default）

```
传统思维：系统发生事件 → 通知用户
正确思维：系统发生事件 → 判断是否值得打扰 → 大部分静默
```

| 事件级别 | 触达方式 | 示例 |
|:--------:|----------|------|
| **P0 紧急** | 推送 + 站内信 | 配额耗尽、网络断连 |
| **P1 重要** | 站内信 | Mission 验收完成 |
| **P2 一般** | 聚合后批量 | 每日摘要 |
| **P3 低优** | 仅记录 | 操作日志 |

> **原则**：90% 的事件应该是 P2/P3，不主动打扰。

---

### 原则二：信号必须"可行动"（Actionable Signal）

```
无效通知：     "你的配额用了 50%"（然后呢？）
有效通知：     "配额还剩 3 天，[立即续费] / [查看用量]"
                                    ↑ 一键操作
```

| 通知类型 | 可行动性 | 是否保留 |
|----------|:--------:|:--------:|
| 纯信息告知 | ❌ | 降级为日志 |
| 带操作入口 | ✅ | 保留 |
| 需要用户决策 | ✅ | 保留 |

> **原则**：每条通知必须回答"用户看到后该做什么"。

---

### 原则三：用户可控（User Controllable）

```
系统默认 ────────────────────────→ 用户偏好
   │                                  │
   │  系统认为重要的                   │  用户认为重要的
   │  （可能是噪音）                   │  （真正的信号）
   │                                  │
   └─────────── 用户可覆盖 ───────────┘
```

| 控制维度 | 用户能做什么 |
|----------|--------------|
| **通道** | 关闭邮件 / 只保留站内信 |
| **类型** | 关闭某类通知 |
| **静默期** | 设置勿扰时间 |
| **阈值** | 只在配额 < 10% 时提醒 |

> **原则**：信噪比的最终裁判是用户，不是系统。

---

### 原则四：发布权控制（Publisher Control）

| 权限 | 谁有 | 风险 |
|------|------|------|
| **接收** | 几乎所有人 | 低（信息透明） |
| **发布** | 受控 | **高（信息污染）** |

**发布权分级**：

| 级别 | 发布者 | 范围 | 审批 |
|:----:|--------|------|:----:|
| **L0** | 系统自动 | 按规则触发 | 免审 |
| **L1** | T营 | 全局广播 | 免审 |
| **L2** | E队队长 | 团队内 | 免审 |
| **L3** | E队成员 | 需审批 | ✅ |

> **原则**：N 的治理核心是**发布权控制**——谁能发、发给谁、发什么。

---

### 原则五：拉推统一（Pull + Push）

| 模式 | 传统 UI | N 的本质 |
|------|---------|----------|
| **拉 (Pull)** | 用户刷新页面看状态 | Dashboard 是"拉" |
| **推 (Push)** | 系统主动告知用户 | **Notify 是"推"** |

> **原则**：A 的 Dashboard 是"拉"（用户主动查看状态），N 是"推"（系统主动触达用户）。**拉 + 推 = 完整的信息闭环**。

---

## §3 深层洞见

### 洞见一：N 是 TAES 的"时间维度"

TAES 四字描述的是**空间结构**（谁持有什么、谁托举谁）。N 补充了时间维度：

| 维度 | TAES 四字 | N |
|------|-----------|---|
| **空间** | T在哪、A怎么连、E是谁、S做什么 | — |
| **时间** | — | **什么时候发生了什么** |

> **洞见**：没有 N，TAES 是建筑蓝图；有了 N，TAES 是运转中的城市。

---

### 洞见二：N 是 TAES 的"神经系统"

```
          ┌─────────────────────────────────────┐
          │           N (Event Bus)             │
          │         神经系统 / 信息传导          │
          └─────────────────────────────────────┘
                ↙         ↓         ↓         ↘
            ┌───┐     ┌───┐     ┌───┐     ┌───┐
            │ T │     │ A │     │ E │     │ S │
            └───┘     └───┘     └───┘     └───┘
```

**事件流向**：

| 发布者 | 事件类型 | 订阅者 |
|:------:|----------|:------:|
| **T** | 席位分配、配额调整、合同变更 | E, A |
| **A** | 网络告警、Token 耗尽、Context 更新 | E, S |
| **E** | 成员入队、角色变更、权限调整 | T, S |
| **S** | Mission 创建、验收完成、飞轮触发 | T, E |

> **洞见**：N 不是"通知功能"，是 **TAES 四字之间的信息高速公路**。

---

### 洞见三：N 与 A 的边界

| 场景 | A 的职责 | N 的职责 |
|------|----------|----------|
| Workplane 断连 | 检测状态 | **通知用户** |
| AITa 配额耗尽 | 显示告警 | **推送提醒** |
| AC 语境缺失 | 诊断原因 | **引导补全** |

> **洞见**：A 负责**发现问题**，N 负责**传达问题**。二者是"传感器"与"神经"的关系。

---

### 洞见四：N 的终极形态——意图预判

| 阶段 | N 的能力 | 例子 |
|------|----------|------|
| **L0 被动** | 事件触发通知 | "你的配额用完了" |
| **L1 主动** | 预警通知 | "配额还剩 10%，预计明天耗尽" |
| **L2 智能** | **意图预判** | "检测到你可能需要更多配额，已自动申请" |

> **洞见**：N 的终极目标是**让通知消失**——在用户意识到问题之前，系统已经解决了。

---

### 洞见五：成功标准

> **N 的成功标准不是"发了多少通知"，而是"用户关掉了多少通知设置"。**
>
> 用户从不关闭通知 → 信噪比高 → N 成功
>
> 用户关闭所有通知 → 信噪比低 → N 失败

---

## §4 V1 规格（前端工程师专用）

### V1 定位

```
N V1 = 最小可行通知系统（信噪比优先）
    │
    ├── 🔔 [已升级为顶级分区]
    ├── 地址段：T3.15.x
    └── 仅做高信噪比事件
```

---

### V1 菜单结构

| L1 菜单 | L2 子菜单 | 路由 | TAES地址 | 说明 |
|---------|-----------|------|:--------:|------|
| **Notify** | Inbox | `/notifications` | T3.15.1.1 | 站内信列表 |
| | Preferences | `/notifications/settings` | T3.15.1.2 | 用户订阅偏好 |

---

### V1 页面规格

#### Inbox 页面 (`/notifications`)

| 区块 | 功能 | 交互 |
|------|------|------|
| **筛选栏** | 全部 / 未读 / P0紧急 / P1重要 | Tab 切换 |
| **通知列表** | 时间倒序，显示标题+摘要+时间 | 点击展开详情 |
| **操作按钮** | 每条通知带可行动入口 | 一键跳转 |
| **批量操作** | 全部已读 / 删除已读 | 顶部按钮 |

**通知卡片结构**：

```
┌─────────────────────────────────────────────────┐
│ 🔴 P0  配额已耗尽                    2 分钟前   │
├─────────────────────────────────────────────────┤
│ 你的 AITa 配额已用完，AI 功能暂停。             │
│                                                 │
│ [立即续费]  [查看用量]  [联系 T营]              │
└─────────────────────────────────────────────────┘
```

#### Preferences 页面 (`/notifications/settings`)

| 区块 | 功能 | 默认值 |
|------|------|--------|
| **通道设置** | 站内信 ✅ / 邮件 ☐ | 仅站内信 |
| **类型订阅** | 按 TAES 分区勾选 | 全部开启 |
| **静默时段** | 勿扰时间段 | 无 |
| **阈值设置** | 配额提醒阈值（10%/20%/30%） | 10% |

---

### V1 事件清单（仅高信噪比）

| 事件源 | 事件 | P 级 | 触达 | 操作入口 |
|:------:|------|:----:|------|----------|
| **A** | Workplane 断连 | P0 | 推送+站内信 | [查看状态] [联系 T营] |
| **A** | 配额 < 阈值 | P1 | 站内信 | [查看用量] [续费] |
| **A** | 配额耗尽 | P0 | 推送+站内信 | [立即续费] |
| **T** | 席位分配成功 | P1 | 站内信 | [开始使用] |
| **S** | Mission 验收通过 | P2 | 每日聚合 | [查看详情] |
| **E** | 成员加入团队 | P2 | 每日聚合 | [查看成员] |

> **V1 原则**：只做 6 个高信噪比事件，不贪多。

---

### V1 数据模型

```typescript
interface Notification {
  id: string;
  userId: string;           // 接收者
  source: 'T' | 'A' | 'E' | 'S' | 'System';
  priority: 'P0' | 'P1' | 'P2' | 'P3';
  title: string;
  body: string;
  actions: Action[];        // 可行动入口
  read: boolean;
  createdAt: Date;
}

interface Action {
  label: string;            // "立即续费"
  route: string;            // "/admin/aita/quota"
  primary?: boolean;        // 主操作高亮
}

interface UserPreference {
  userId: string;
  channels: {
    inbox: boolean;         // 站内信（不可关闭）
    email: boolean;         // 邮件
  };
  subscriptions: {
    T: boolean;
    A: boolean;
    E: boolean;
    S: boolean;
  };
  silentHours?: {
    start: string;          // "22:00"
    end: string;            // "08:00"
  };
  quotaThreshold: number;   // 10 | 20 | 30
}
```

---

### V1 API 接口

| 接口 | 方法 | 说明 |
|------|:----:|------|
| `/api/notifications` | GET | 获取通知列表（支持分页/筛选） |
| `/api/notifications/:id/read` | POST | 标记已读 |
| `/api/notifications/read-all` | POST | 全部已读 |
| `/api/notifications/preferences` | GET/PUT | 用户偏好 |

---

### V1 权限

| 角色 | Inbox | Preferences | 发布通知 |
|:----:|:-----:|:-----------:|:--------:|
| **T营** | ✅ | ✅ | ✅ P0-P2 |
| **E队** | ✅ 自己的 | ✅ 自己的 | ⚠️ 需审批 |
| **操作员** | ✅ 只读 | ❌ | ❌ |
| **系统** | — | — | ✅ 自动触发 |

---

### V1 前端实施检查清单

| 检查项 | 状态 | 说明 |
|--------|:----:|------|
| Inbox 路由 `/notifications` | ⬜ | 新增页面 |
| Preferences 路由 `/notifications/settings` | ⬜ | 新增页面 |
| 通知卡片组件 | ⬜ | 含 P 级徽章 + 操作按钮 |
| 全局通知图标（Header） | ⬜ | 未读数角标 |
| 偏好表单组件 | ⬜ | 通道/类型/静默/阈值 |

---

### V1 不做的事（明确边界）

| 功能 | 状态 | 原因 | 何时重拾 |
|------|:----:|------|----------|
| 多通道（微信/钉钉） | ❌ | 集成成本高 | V2 |
| 通知模板管理 | ❌ | 硬编码即可 | 事件 > 20 个 |
| 规则引擎 | ❌ | 过度设计 | 用户量 > 1000 |
| 事件总线 | ❌ | 工程化过重 | 需解耦时 |
| 意图预判 | ❌ | 需 AI + 数据 | AI 成熟后 |

---

## 附：与其他文档的关系

| 文档 | 内容 | 何时查阅 |
|------|------|----------|
| [Te3.lsn189.cn.md](Te3.lsn189.cn.md) | 菜单清单（路由/地址） | 确认路由与地址段 |
| [Te3.lsn189.cn.explainer.md](Te3.lsn189.cn.explainer.md) | MU/AC/CA/CP 概念 | 理解术语体系 |
| [Te3.lsn189.cn.A.explainer.md](Te3.lsn189.cn.A.explainer.md) | [A] Augment 说明 | 理解托举层 |
| [Te3.lsn189.cn.T.explainer.md](Te3.lsn189.cn.T.explainer.md) | [T] TeamsCamp 说明 | 理解资源持有层 |
