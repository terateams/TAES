# ATP 界面框架 V2

## 核心理念：AI 托举（AI Augmented）

> **托举（Augmented）** 是我们的商业符号，贯穿始终。
>
> ATP 不是普通的「表格页」，而是 **AI 托举的任务处理页面（AI Augmented Task Page）**。

### 什么是「托举」？

「托举」意味着 AI 不是替代人，而是 **从下方支撑、抬升人的能力边界**：

- AI 托举 **认知**：通过 AC 提供业务语境、SOP、决策依据，减少信息搜寻成本
- AI 托举 **执行**：通过模板生成、智能校验、批量处理，放大单次操作的价值
- AI 托举 **审计**：通过可追溯的 AC 链，让每一步决策都有据可查

### ATP 三层架构

| 缩写 | 全称 | 中文 | 定位 |
|------|------|------|------|
| **ATP** | Attention Task Page | 关注任务页 | 业务入口页面，承载工作项列表与全局操作 |
| **TP** | Task Panel | 任务面板 | 详情窗口，承载单个工作项的查看/编辑/克隆 |
| **AC** | Augmented Context | 托举上下文 | 上下文预览/操作组件，AI 输入/输出的核心载体 |

> **关系**：`ATP ⊃ TP ⊃ AC`（Page 包含 Panel，Panel 包含 Context）

### 关键术语约定

- **Task**：工作项（work item），不是定时任务（cron job）或后台队列任务
- **Attention**：关注模式，把需要处理的工作项凸显出来
- **Augmented / 托举**：AI 增强能力的统一表达，是产品的核心差异点

---

## 1. 一句话定义（团队口径）

**ATP = AI 托举的任务处理页面（AI Augmented Task Page）**

公式表达：`ATP = 标准 CRUD + Augmented Context（托举上下文）`

- 没有 AC 的 ATP 只是普通 CRUD
- 具备 AC 且能驱动 AI 辅助决策/生成/校验并可回写，才称得上 **AI 托举**

---

## 2. ATP 的核心目标

ATP（Attention Task Page）用于以「业务维度」组织、筛选、处理一组相关业务数据，提供 **AI 托举** 的标准操作页面：

### 2.1 标准操作（7 项）

| 操作 | 选择模式 | 说明 |
|------|----------|------|
| **Context** | 单选 | 唤起 AC（托举上下文）预览/编辑 |
| **View** | 单选 | 打开 TP（任务面板）查看详情 |
| **Edit** | 单选 | 打开 TP 编辑工作项 |
| **Clone** | 单选 | 基于选中项克隆新工作项 |
| **Add** | 单选 | 创建全新工作项 |
| **Delete** | 单选 + 多选 | 删除/归档工作项 |
| **Import** | 单选 | 导入模板/附件到当前工作项 |

### 2.2 标准能力

- 快速筛选/查询（Attention Filter + Keyword）
- 列表展示与选择（Table List）
- 托举上下文（AC）的输入/预览/复制/编辑
- 标准分页、导出、标题配置

**适用对象**：凡是「以某一类业务记录为中心，存在批量查看、筛选、编辑与处理动作」的页面，都可以用 ATP 来落地。

---

## 3. AI 托举的判据（什么叫「真正的托举」）

为了避免「加一段 Markdown 就自称 AI 托举」的自嗨，ATP 的托举能力必须可被验证：

| # | 判据 | 说明 |
|---|------|------|
| 1 | **AC 一等公民** | AC 不是备注；它是业务语境、SOP/Prompt、资料包、决策记录的统一载体 |
| 2 | **输入输出闭环** | AI 输入来自 AC，AI 输出能回写到业务对象（字段/AC/附件/日志） |
| 3 | **可追溯可审计** | 谁触发、用什么模板、生成了什么、落库在哪里——全程可追踪 |
| 4 | **模板可复用** | AC 模板来源可管理（Context Book），支持版本化演进 |
| 5 | **人类在回路** | 先建议、再确认、后落库——不是黑箱自动改生产数据 |

> **直白点**：AI 托举不是「加 AI 按钮」，而是把 AI 的语境、输入、输出、审计都设计进系统。

---

## 4. TeamsEdge + VS Code 双主场模型

| 主场 | 定位 | 核心能力 |
|------|------|----------|
| **TeamsEdge** | 业务处理与审计 | UI/权限/审计/数据存储/标准交互（ATP/TP/AC） |
| **VS Code Workbench** | 工程编排与版本化 | 脚本/模板/Prompt/批量变更 + Git 协作 |

两者通过 **AC（托举上下文）** 连接：

- AC 模板/规范在 TeamsEdge 中管理（Context Book）
- 复杂的工程化动作在 VS Code Workbench 中编排、review、沉淀
- 结果回写 TeamsEdge，形成审计链与可追溯记录

> **简化理解**：TeamsEdge 是「业务托举的主场」，VS Code 是「工程托举的主场」。

---

## 5. ATP 的边界（不做清单）

ATP 是「AI 托举的任务处理页面」，不是万能容器：

| ❌ 不做 | 应该用 |
|---------|--------|
| 复杂的跨实体流程编排 | workflow/flow 页面 |
| 重度的可视化大屏 | dashboard/metrics |
| 把「定时/异步后台任务」称为 Task | 避免语义冲突 |
| 仅展示、无处理动作的页面强行套 ATP | 会稀释 ATP 的语义 |
| AI 行为做成不可追溯的黑箱 | 必须可解释/可审计/可回滚 |

---

## 6. ATP 的标准布局（UI 结构）

ATP（Attention Task Page）是 **AI 托举** 的业务操作核心单位，旨在透过视觉框架锁定 **Attention（关注）区域**，解决信息过载问题。

ATP 页面按标准四层结构组织（L1 → L2 → 中间 → Ln）：

### 6.0 整體佈局概覽

```
┌─────────────────────────────────────────────────────────────────┐
│ L1 (導航中心)                                                    │
│ [Business Title / Subtitle]              [AC] [V/E/C] [Add] [Del]│
├─────────────────────────────────────────────────────────────────┤
│ L2 (認知過濾層)                                                   │
│ {Attention Action} [Keyword] [#Tag1] [#Tag2]   [Export MD] [Export Visual]│
├─────────────────────────────────────────────────────────────────┤
│ 中間區域 (Tab 化空間)                                             │
│ ┌─────────┬─────────┬─────────┬─────────┐                       │
│ │ Tab 1   │ Tab 2   │ Tab 3   │ Tab 4   │                       │
│ ├─────────┴─────────┴─────────┴─────────┤                       │
│ │                                        │                       │
│ │           Table List                   │ → 點擊觸發 TP (Task Panel)│
│ │                                        │                       │
│ └────────────────────────────────────────┘                       │
├─────────────────────────────────────────────────────────────────┤
│ Ln (底頁框架)                                                     │
│ [Pagination]                    [ATPID: 3.4.104] [Edit Title] [Export Attentioned]│
└─────────────────────────────────────────────────────────────────┘
```

### 6.1 L1（導航中心）

| 位置 | 元素 | 說明 |
|------|------|------|
| **左側** | Business Title / Subtitle | 業務主標題與副標題，採用清晰文字呈現 |
| **右側** | `[AC]` | Augmented Context（托举上下文），唤起 AC 预览 |
| | `[V/E/C]` | View / Edit / Clone，觸發 TP（Task Panel）詳情面板 |
| | `[Add]` | 快速建立新工作項 |
| | `[Del]` | 刪除 / 歸檔（支持單選與多選） |

> 四大固定按钮 `[AC] [V/E/C] [Add] [Del]` 是 ATP 的标准操作入口，确保一致的用户心智模型。
>
> - `[AC]`：托举上下文（Augmented Context）
> - `[V/E/C]`：View / Edit / Clone → 触发 TP（Task Panel）
> - `[Add]`：新建工作项
> - `[Del]`：删除/归档

### 6.2 L2（認知過濾層）

| 位置 | 元素 | 說明 |
|------|------|------|
| **左側** | `{Attention Action}` | 預設過濾組合（例如 POC / 過期 / 異常） |
| | `[Keyword 搜尋框]` | 關鍵詞即時過濾 |
| | `[#標籤1] [#標籤2]` | 標籤快捷過濾器，實現精確的對象鎖定 |
| **右側** | `[Export to MD]` | 獨立文本導出，服務於 AI 互動場景 |
| | `[Export Visual]` | 合併 PNG/JPG/PDF 導出，服務於視覺存檔 |

> L2 的设计理念：**认知先行，执行在后**。先通过过滤收窄关注范围，再进行具体操作。
>
> 导出服务于 AI 托举场景：MD 便于 AI 解析，Visual 便于人类存档。

### 6.3 中間區域（Tab 化空間）

採用「**認知與執行分離**」設計：

| Tab | 定位 | 說明 |
|-----|------|------|
| **Tab 1** | 核心變更層 | 顯示具備業務屬性的 Table List（主工作項清單） |
| **Tab 2/3/4** | 關聯清單 | 基於不同業務流程顯示關聯數據（例如歷史記錄、關聯對象、統計視圖） |

**Table List 互動規則：**
- 單擊列表項：選中該工作項，更新 L1 的 Work Meta 摘要
- 雙擊列表項：觸發彈出 **TP（Task Panel）業務面板**
- 多選模式：支持批量 Delete 操作

### 6.4 Ln（底頁框架）

| 位置 | 元素 | 說明 |
|------|------|------|
| **左側** | `[Pagination]` | 翻頁等清單控制操作 |
| **右側** | `[ATPID]` | 例如 `3.4.104`，点击可快速唤起对应 AC |
| | `[Edit Title]` | 編輯當前 ATP 的標題與副標題 |
| | `[Export Attentioned]` | 僅導出當前關注（已過濾）的清單 |

> ATPID 是 ATP 的唯一標識符，遵循 `{模块}.{子模块}.{序号}` 的編碼規則。

### 6.5 標題區的「Work Item 解釋力」（建議標準）

标题区不只是“页面名”，它应该帮助操作者快速理解：**当前面板的 work item 是什么**、**关键字段属于哪一类关系**。

建议在 Header Toolbar 固化以下组件（ATPView 基类已支持）：

- `Work item` 提示：一句话说明“ATP 的每一行就是一个工作项（work item）”
- 类型图例（Legend）：`ATP / EXT / DB / AC`
  - `ATP`：依赖/耦合关系（应可跳转到对应 ATP）
  - `EXT`：外部业务数据（以依赖为主，不强行内化）
  - `DB`：内部数据（数据库查询关系/属性字段）
  - `AC`：Augmented Context 的唯一对应（AC ID）
- 选中项摘要（Work Meta）：随选中行更新的“关键字段摘要”，用于减少频繁打开详情抽屉

---

## 7. 关键概念与字段约定

### 7.1 Task（工作项）

ATP 面板中展示的每一行数据，是一个“工作项（work item）”：

- 有唯一标识（id）
- 可被筛选/定位
- 可编辑/克隆/创建/删除（至少具备其中一部分动作）

### 7.2 Attention Mode（关注模式）

Attention Mode 是“面板上的一种视图模式”，用于把需要关注的工作项过滤出来。

- 对不同业务面板，其 Attention 逻辑可以不同（例如 POC、过期、异常等）
- 但交互上保持一致：一个可切换入口 + 切换后刷新列表

### 7.3 AC（Augmented Context / 托举上下文）

AC 用于承载与该工作项关联的 **托举语境**：说明、约束、提示词、SOP、资料链接、决策记录等内容，通常为 Markdown 文本。

AC 是 AI 托举的核心载体：
- AI 的 **输入**：从 AC 读取业务语境、模板、指令
- AI 的 **输出**：生成结果回写到 AC 或关联字段
- **审计链**：AC 的变更历史可追溯

技术实现：
- 默认字段：`remark`
- 可通过 `contextId` 指定其他字段（例如 `content`）
- 展示方式：表格 Context 列点击预览 / 顶部 `[AC]` 按钮 / TP 内 Context Tab

---

## 8. AC（Augmented Context / 托举上下文）标准组件

AC（Augmented Context）是 ATP 的 **托举上下文** 预览/操作组件，采用 **悬浮卡片（Floating Card）** 设计：

### 8.1 AC 的展现形式：悬浮卡片

AC 采用 **从左向右拉出** 的悬浮卡片设计，停留在 ATP 页面之上：

```
ATP 页面
┌─────────────────────────────────────────────────────────────────┐
│ L1 / L2 / Table List / Ln                                       │
│    ↑ 半个字符高度间隙                                             │
│    ┌─────────────────────────────────────────┐                  │
│    │ AC - <Entity> - <DisplayName>           │ ← 悬浮卡片        │
│ ←→ │ AC ID: 3.4.104                          │                  │
│ 1字符│                                        │                  │
│    │  ┌─────────────────────────────────┐    │                  │
│    │  │ Scene (场景)                     │    │                  │
│    │  │ ─────────────────────────────── │    │                  │
│    │  │ History Data Story (历史故事)    │    │                  │
│    │  │ ─────────────────────────────── │    │                  │
│    │  │ Intention (意图)                 │    │                  │
│    │  │ Skill (技能)                     │    │                  │
│    │  └─────────────────────────────────┘    │                  │
│    │                                          │                  │
│    │  [MD Copy] [PNG Copy] [Edit] [执行复核]   │ ← 动态 Agent 动作│
│    └─────────────────────────────────────────┘                  │
└─────────────────────────────────────────────────────────────────┘
```

**布局规范**：
- **上边距**：半个字符高度间隙
- **左边距**：一个字符宽度
- **拉出方向**：从左向右滑出
- **层级**：悬浮于 ATP 页面之上，不遮挡 L1 导航

### 8.2 AC 入口

| 入口 | 触发方式 | 说明 |
|------|----------|------|
| `[AC]` 按钮 | 点击 L1 的 `[AC]` | 唤起当前选中工作项的 AC |
| `ATPID` | 点击 Ln 的 ATPID（如 `3.4.104`） | 快速唤起对应 AC |
| Context 列 | 点击表格 Context 列链接 | 直接预览该行的 AC |
| TP 内 Tab | 打开 Task Panel 的 Context Tab | 在详情面板内编辑 AC |

> AC 会根据 **当前焦点**（如选中第 104 号工作项）自动显示对应内容。

### 8.3 AC 的微观内容结构

AC 采用 **Markdown（MD）格式** 呈现以下标准区块：

| 区块 | 说明 | 托举价值 |
|------|------|----------|
| **Scene（场景）** | 当前工作项的业务场景描述 | 帮助 AI 理解上下文 |
| **History Data Story（历史故事）** | 相关历史数据的叙事化呈现 | 提供决策依据 |
| **Intention（意图）** | 当前操作的业务意图 | 驱动 Agent 推荐动作 |
| **Skill（技能）** | 可调用的 AI 技能列表 | 明确 AI 能力边界 |

```markdown
# Scene（场景）
当前工作项属于 [E-Team: Alpha]，处于 POC 阶段...

# History Data Story（历史故事）
- 2026-01-10：首次创建，来源于客户需求
- 2026-01-15：完成初步评估，建议进入下一阶段

# Intention（意图）
执行复核：确认数据完整性，准备提交审批

# Skill（技能）
- [x] 数据完整性校验
- [x] 自动生成审批摘要
- [ ] 发送通知（需权限）
```

### 8.4 主动辅助：动态 Agent 动作

AC 的底部按钮区会 **根据当前 Intention（意图）动态变更**：

| 场景 | 按钮变化 | 说明 |
|------|----------|------|
| 默认状态 | `[MD Copy] [PNG Copy] [Edit] [AI Gen]` | 标准操作 |
| Intention = 复核 | `[MD Copy] [PNG Copy] [Edit] [执行复核]` | 推荐 Agent 动作 |
| Intention = 审批 | `[MD Copy] [PNG Copy] [Edit] [提交审批]` | 推荐 Agent 动作 |
| Intention = 通知 | `[MD Copy] [PNG Copy] [Edit] [发送通知]` | 推荐 Agent 动作 |

> **托举核心**：AI 不只是「能做」，而是「主动推荐该做什么」。

### 8.5 AC 顶部栏标准内容

| 元素 | 说明 |
|------|------|
| `AC` 标识 | 固定展示，提升可识别性 |
| 标题 | `AC - <Entity> - <DisplayName>` |
| `AC ID` | 遵循路由规范（见 8.6） |

### 8.6 AC ID 路由机制

AC ID 参考 **TCP/IP 路由规范** 设计，确保业务路径路由可达：

```
AC ID 格式：{模块}.{子模块}.{序号}
示例：3.4.104

含义：
- 3：一级业务模块（如 Team Management）
- 4：二级子模块（如 Player）
- 104：工作项序号
```

**路由价值**：
- **唯一标识**：每个 AC 有全局唯一的地址
- **可寻址**：通过 AC ID 可直接定位到具体工作项
- **可跳转**：ATP 之间通过 AC ID 实现穿透导航
- **可追溯**：审计日志记录 AC ID，便于回溯

### 8.7 AC 操作按钮（完整列表）

| 按钮 | 功能 | 托举价值 |
|------|------|----------|
| `Markdown Copy` | 复制 MD 原文 | 便于粘贴到 AI 对话 |
| `PNG Copy` | 复制预览截图 | 便于视觉存档 |
| `Edit` | 回到 TP 编辑 | 闭环修改 |
| `[动态 Agent 动作]` | 根据 Intention 推荐 | 主动托举 |

### 8.8 Context ID 的语义

Context ID 用于把「某条工作项的 AC 内容」与「Context Book 中定义的模板/条目」建立对应关系，便于：

- **追溯来源**：知道 AC 是从哪个模板生成的
- **复用与标准化**：模板可被多个工作项引用
- **运营与分析**：统计某类 AC 的使用频率、覆盖面

---

## 9. 实现建议（开发者落地指南）

### 9.1 典型页面如何接入 ATP

一个 ATP 页面通常只需要：

- 设置 `title/icon/detailNameField/viewPrefix`（或 `tableId` 推断 viewPrefix）
- 设置 CRUD API：`queryUrl/addUrl/updateUrl/deleteUrl/exportUrl`
- 覆盖：
  - `getTableColumns()`：列定义
  - `getFilters()`：过滤器
  - `getBasicFormRows()`：编辑表单字段

可选扩展：

- `beforeSaveForm(values)`：保存前清洗/规范化
- `beforeCloneItem(item)`：克隆时清空唯一字段
- `getCreateDefaults()`：新建默认值
- `getFormElementsExtended()`：为编辑窗口添加额外 Tab/区域

### 9.2 AC 字段不是 remark 的情况

当业务实体的 AC 字段不是 `remark`（例如 Markdown Book 用 `content`），应：

- `getDataTable(columns, { contextId: "content" })`
- `getContextColumn(true, "content")`

ATP 会把该字段映射到预览用的 `remark`，以复用 AC 组件。

### 9.3 标题区摘要与字段类型标注（推荐做法）

为某个 ATP 页面提供“标题区 Work Meta 摘要”，建议在页面类中实现：

- `getWorkItemMetaSpec()`：返回一个数组，描述要展示的关键字段及其类型
  - `kind`: `atp | external | internal | ac`
  - `label`: 展示名
  - `field`: 从工作项取值的字段名
  - `jet`（仅 kind=atp 时）：要跳转的 Jet 路由（例如 `team.teaminfo`）

示例（Player ATP 的口径）：

- E-Team（kind=atp，可跳转到 TeamInfo ATP）
- M365 Account（kind=external）
- ET Level / Expire（kind=internal）
- AC ID（kind=ac，从 Context Book 自动解析）

这样做的价值：

- 让「AI 托举的 AC」与「业务字段关系」在界面上被一眼看懂
- 降低新同事理解成本，减少误把外部依赖当内部对象的风险

### 9.4 ATP Work Item 的列跳转规则（推荐做法）

当某一列表达的是 **ATP 与 ATP 的耦合关系**（例如 Player 的 E-Team 指向 TeamInfo），该列应提供可点击跳转：

- 列模板使用 `do_atp_nav` 链接（ATPView 基类提供统一 click handler）
- 仅对“耦合/内部对象”提供跳转；外部依赖（EXT）默认不做内部跳转

这条规则是为了让 ATP 形成“工作台式”的可穿透导航，而不是孤岛式 CRUD。

---

## 10. 名称与文案规范（对外口径）

| 缩写 | 英文全称 | 中文 | 说明 |
|------|----------|------|------|
| **ATP** | Attention Task Page | 关注任务页 | AI 托举的业务入口页面 |
| **TP** | Task Panel | 任务面板 | 单个工作项的详情窗口 |
| **AC** | Augmented Context | 托举上下文 | AI 输入/输出的核心载体 |
| **Task** | Work Item | 工作项 | 不是后台任务/定时任务 |
| **托举** | Augmented | — | 产品核心差异点，贯穿始终 |

> **经验**：缩写可以保留「工程师默契」，但展开必须能对新人解释清楚。
>
> **商业符号**：「托举」是我们的核心表达，所有 Augmented 都应翻译为「托举」。

---

## 11. 代码参考

| 组件 | 文件路径 | 说明 |
|------|----------|------|
| ATPView 基类 | `client/sources/views/atp.js` | ATP/TP/AC 大部分能力在此 |
| Context Book | `client/sources/views/data/markdown_book.js` | AC 模板来源示例（ATP1623） |
| Template API | `controllers/markdown/markdown.go` | `/admin/markdown/template/options` |

---

## 12. 版本历史

| 版本 | 日期 | 变更 |
|------|------|------|
| V2 | 2026-01-17 | 引入「托举」理念；ATP/TP/AC 三层架构；7 项标准操作 |
| V1 | — | 初版 ATP/CMP 标准 |
